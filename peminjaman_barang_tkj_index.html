<!--
README / Panduan Lengkap (untuk orang awam)

File ini adalah sebuah aplikasi satu-file (index.html) yang bisa langsung dijalankan di browser atau di-host di GitHub Pages.

1) Menjalankan secara lokal (paling mudah)
   - Simpan file ini sebagai "index.html" di folder baru di komputer Anda.
   - Buka folder -> klik kanan pada index.html -> Open with -> pilih browser (Chrome/Edge/Firefox).
   - Atau: instal VS Code -> buka folder -> klik kanan index.html -> "Open with Live Server" (jika install ekstensi Live Server).

2) Menaruh di GitHub (supaya jadi website online)
   - Buat akun GitHub di https://github.com jika belum punya.
   - Klik tombol "New repository".
   - Isi nama repo: misal "peminjaman-barang-tkj". Pilih Public. Klik Create repository.
   - Di halaman repo, klik "Add file" -> "Upload files" -> tarik (drag) file index.html yang sudah Anda simpan -> klik Commit changes.
   - Masuk ke Settings -> Pages (atau "Pages" di sidebar). Pada bagian "Build and deployment" pilih branch "main" dan folder ". (root)" lalu Save.
   - Setelah beberapa menit, website Anda akan aktif di: https://<username>.github.io/peminjaman-barang-tkj

3) Cara menginput data peminjaman (di aplikasi)
   - Halaman utama: ada form "Pinjam Barang".
   - Isi Nama, Kelas, Nama Barang.
   - Pilih tanggal (bisa klik ikon jam untuk isi otomatis tanggal hari ini).
   - Upload Foto (WAJIB) -- tekan Choose file -> pilih foto barang atau foto bukti.
   - Tekan "Simpan Peminjaman". Jika kosong/tdk ada foto, akan memberi peringatan.

4) Cara mengembalikan barang
   - Di daftar transaksi, temukan baris yang statusnya "Dipinjam".
   - Klik "Kembalikan" -> isi kondisi barang, pilih tanggal pengembalian, upload foto kondisi (opsional tapi disarankan) -> klik "Simpan Pengembalian".

5) Edit / Hapus data
   - Tersedia tombol Hapus untuk menghapus baris.
   - Data disimpan di browser (localStorage). Untuk memindahkan ke komputer lain, gunakan fitur export CSV di bawah tabel.

6) Catatan teknis singkat
   - Data disimpan di browser (localStorage) dalam bentuk JSON.
   - Foto disimpan sebagai dataURL base64 di localStorage (jangan masukkan foto terlalu besar, agar tidak memenuhi penyimpanan browser).
   - Jika ingin menyimpan di server/ database, perlu setup backend (bisa kita bantu nanti).

-->

<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Peminjaman Barang TKJ</title>
  <style>
    /* Reset */
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%}
    body{
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: radial-gradient(1200px 600px at 10% 10%, rgba(58,123,213,0.12), transparent),
                  radial-gradient(900px 400px at 90% 90%, rgba(120,64,200,0.08), transparent),
                  #06070a;
      color:#e6eef8;
      -webkit-font-smoothing:antialiased;
      padding:32px;
    }

    /* Container */
    .app{
      max-width:1100px;margin:0 auto;background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));
      border-radius:20px;padding:28px;box-shadow: 0 10px 30px rgba(2,6,23,0.7);border:1px solid rgba(255,255,255,0.04);
      position:relative;overflow:hidden;
    }

    header{display:flex;align-items:center;gap:18px;margin-bottom:20px}
    .logo{width:72px;height:72px;background:linear-gradient(90deg,#6ee7b7,#60a5fa);border-radius:14px;display:grid;place-items:center;color:#041018;font-weight:700;font-size:18px;box-shadow:0 6px 18px rgba(96,165,250,0.12);}
    h1{font-size:22px}
    p.lead{opacity:.75}

    /* Columns */
    .grid{display:grid;grid-template-columns:420px 1fr;gap:20px}

    /* Card */
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:18px;border-radius:14px;border:1px solid rgba(255,255,255,0.03);}

    label{display:block;font-size:13px;color:#cfe8ff;margin-bottom:6px}
    input[type="text"], input[type="date"], select, textarea{width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
    input[type="file"]{color:inherit}
    .row{display:flex;gap:10px}

    button.primary{background:linear-gradient(90deg,#7c3aed,#06b6d4);border:none;color:#041018;padding:10px 14px;border-radius:10px;font-weight:700;cursor:pointer}
    button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:inherit;padding:8px 12px;border-radius:10px;cursor:pointer}

    /* Table */
    table{width:100%;border-collapse:collapse;margin-top:12px;color:#d9f2ff}
    th,td{padding:8px;text-align:left;border-bottom:1px dashed rgba(255,255,255,0.03);font-size:13px}
    th{opacity:.85}
    .thumb{width:64px;height:40px;object-fit:cover;border-radius:6px;border:1px solid rgba(255,255,255,0.06)}

    /* Status pill */
    .pill{display:inline-block;padding:6px 10px;border-radius:999px;font-weight:700;font-size:12px}
    .pill.borrowed{background:linear-gradient(90deg,#ffb86b,#ff7a7a);color:#081014}
    .pill.returned{background:linear-gradient(90deg,#7efc9f,#60a5fa);color:#041018}

    /* Modal */
    .modal{position:fixed;inset:0;background:rgba(2,6,23,0.6);display:none;align-items:center;justify-content:center;padding:20px}
    .modal.show{display:flex}
    .modal .box{width:640px;max-width:100%;background:#071021;padding:18px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)}

    /* Laser animation */
    .laser-wrap{position:absolute;left:-120px;top:-80px;width:400px;height:400px;pointer-events:none}
    .laser{width:100%;height:100%;background:linear-gradient(90deg, transparent 10%, rgba(124,58,237,0.18) 40%, rgba(6,182,212,0.18) 60%, transparent 90%);
      transform-origin:center;filter:blur(12px);opacity:.9;animation:spin 14s linear infinite}
    @keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}

    /* Neon lines */
    .corner-lines:before, .corner-lines:after{content:"";position:absolute;height:2px;width:120%;left:-10%;top:0;background:linear-gradient(90deg,transparent,#7c3aed,transparent);opacity:.06}
    .corner-lines:after{bottom:0;top:auto}

    /* Responsive */
    @media (max-width:900px){.grid{grid-template-columns:1fr}.logo{display:none}}

    /* Help panel */
    .help{font-size:13px;line-height:1.45;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.01));padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.02)}

    footer{margin-top:18px;text-align:center;opacity:.6;font-size:13px}
  </style>
</head>
<body>
  <div class="app">
    <div class="laser-wrap" aria-hidden="true"><div class="laser"></div></div>
    <div class="corner-lines"></div>

    <header>
      <div class="logo">TKJ</div>
      <div>
        <h1>Peminjaman Barang TKJ</h1>
        <p class="lead">Sederhana • Modern • Web-ready. Isi data peminjaman dan pengembalian lengkap dengan foto.</p>
      </div>
    </header>

    <div class="grid">
      <div>
        <div class="card">
          <h3>Form Pinjam Barang</h3>
          <p style="opacity:.8;margin-bottom:10px">Isi semua field dan upload foto untuk menyimpan peminjaman.</p>

          <form id="borrowForm">
            <label>Nama</label>
            <input id="name" type="text" placeholder="Nama peminjam" required>

            <label style="margin-top:8px">Kelas</label>
            <input id="kelas" type="text" placeholder="XI RPL / XII TKJ ..." required>

            <label style="margin-top:8px">Nama Barang</label>
            <input id="item" type="text" placeholder="Contoh: Laptop HP, Kabel HDMI" required>

            <div style="display:flex;gap:8px;margin-top:8px;align-items:center">
              <div style="flex:1">
                <label>Tanggal Peminjaman</label>
                <input id="date" type="date">
              </div>
              <div style="display:flex;flex-direction:column;justify-content:flex-end">
                <button type="button" id="nowBtn" class="ghost">Isi Hari Ini</button>
              </div>
            </div>

            <label style="margin-top:8px">Foto (WAJIB)</label>
            <input id="photo" type="file" accept="image/*">
            <div style="height:8px"></div>
            <div style="display:flex;gap:10px;align-items:center">
              <button id="saveBorrow" class="primary" type="button">Simpan Peminjaman</button>
              <button id="clearAll" class="ghost" type="button">Bersihkan Semua Data</button>
            </div>
          </form>

          <div style="margin-top:12px" class="help">
            Tips: Foto disarankan ukuran < 1.5MB. Jika tombol "Isi Hari Ini" ditekan, tanggal akan otomatis terisi.
          </div>
        </div>

        <div style="height:18px"></div>

        <div class="card">
          <h3>Petunjuk Cepat</h3>
          <ol style="padding-left:18px;margin-top:8px">
            <li>Isi form di kiri, upload foto</li>
            <li>Klik "Simpan Peminjaman" untuk menambah ke daftar</li>
            <li>Untuk mengembalikan, klik "Kembalikan" pada baris</li>
            <li>Gunakan "Export CSV" untuk menyimpan data ke komputer</li>
          </ol>
        </div>
      </div>

      <div>
        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <h3>Daftar Transaksi</h3>
            <div>
              <button id="exportCSV" class="ghost">Export CSV</button>
            </div>
          </div>

          <div style="overflow:auto;max-height:560px;margin-top:8px">
            <table id="table">
              <thead>
                <tr><th>#</th><th>Nama</th><th>Kelas</th><th>Barang</th><th>Tgl</th><th>Foto</th><th>Status</th><th>Aksi</th></tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

        <footer>
          Dibuat untuk keperluan praktikum TKJ — Simpel & Responsive
        </footer>
      </div>
    </div>
  </div>

  <!-- Modal for Return -->
  <div id="modal" class="modal" role="dialog" aria-hidden="true">
    <div class="box">
      <h3>Form Pengembalian</h3>
      <div style="margin-top:8px">
        <label>Kondisi Barang</label>
        <select id="kondisi">
          <option value="Baik">Baik</option>
          <option value="Cacat Ringan">Cacat Ringan</option>
          <option value="Rusak">Rusak</option>
        </select>
        <label style="margin-top:8px">Tanggal Pengembalian</label>
        <input id="returnDate" type="date">
        <div style="height:8px"></div>
        <label>Foto Pengembalian (opsional)</label>
        <input id="returnPhoto" type="file" accept="image/*">
        <div style="height:10px"></div>
        <div style="display:flex;gap:8px;justify-content:flex-end">
          <button id="cancelReturn" class="ghost">Batal</button>
          <button id="saveReturn" class="primary">Simpan Pengembalian</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Simple app using localStorage
    const LS_KEY = 'peminjaman_tkj_v1'
    let data = JSON.parse(localStorage.getItem(LS_KEY) || '[]')

    const tbody = document.querySelector('#table tbody')
    const nameEl = document.getElementById('name')
    const kelasEl = document.getElementById('kelas')
    const itemEl = document.getElementById('item')
    const dateEl = document.getElementById('date')
    const photoEl = document.getElementById('photo')
    const saveBorrow = document.getElementById('saveBorrow')
    const nowBtn = document.getElementById('nowBtn')
    const clearAll = document.getElementById('clearAll')
    const exportCSV = document.getElementById('exportCSV')

    const modal = document.getElementById('modal')
    const cancelReturn = document.getElementById('cancelReturn')
    const saveReturn = document.getElementById('saveReturn')
    const kondisiEl = document.getElementById('kondisi')
    const returnDateEl = document.getElementById('returnDate')
    const returnPhotoEl = document.getElementById('returnPhoto')

    let editingId = null

    function fmtDate(d){
      if(!d) return ''
      const dt = new Date(d)
      if(isNaN(dt)) return d
      return dt.toLocaleDateString('id-ID')
    }

    function render(){
      tbody.innerHTML = ''
      data.forEach((row, i) => {
        const tr = document.createElement('tr')
        tr.innerHTML = `
          <td>${i+1}</td>
          <td>${escapeHtml(row.name)}</td>
          <td>${escapeHtml(row.kelas)}</td>
          <td>${escapeHtml(row.item)}</td>
          <td>${fmtDate(row.date)}</td>
          <td><img class="thumb" src="${row.photo || ''}" alt="foto"></td>
          <td>${row.status === 'borrowed' ? '<span class="pill borrowed">Dipinjam</span>' : '<span class="pill returned">Dikembalikan</span>'}</td>
          <td>${actionButtons(row.id)}</td>
        `
        tbody.appendChild(tr)
      })
    }

    function actionButtons(id){
      const row = data.find(r=>r.id===id)
      if(!row) return ''
      let s = ''
      if(row.status === 'borrowed'){
        s += `<button class="ghost" onclick="startReturn('${id}')">Kembalikan</button> `
      }
      s += `<button class="ghost" onclick="delRow('${id}')">Hapus</button>`
      return s
    }

    window.delRow = function(id){
      if(!confirm('Hapus data ini?')) return
      data = data.filter(r=>r.id!==id)
      saveLS()
      render()
    }

    function saveLS(){
      localStorage.setItem(LS_KEY, JSON.stringify(data))
    }

    function readFileAsDataURL(file){
      return new Promise((res, rej) => {
        const fr = new FileReader()
        fr.onload = ()=>res(fr.result)
        fr.onerror = ()=>rej(fr.error)
        fr.readAsDataURL(file)
      })
    }

    nowBtn.addEventListener('click', ()=>{
      const t = new Date().toISOString().slice(0,10)
      dateEl.value = t
    })

    saveBorrow.addEventListener('click', async ()=>{
      const name = nameEl.value.trim()
      const kelas = kelasEl.value.trim()
      const item = itemEl.value.trim()
      const date = dateEl.value || new Date().toISOString().slice(0,10)
      const file = photoEl.files[0]
      if(!name || !kelas || !item){alert('Nama, kelas, dan nama barang harus diisi');return}
      if(!file){alert('Foto wajib diupload untuk peminjaman');return}
      try{
        const photo = await readFileAsDataURL(file)
        const id = 'id_'+Date.now()
        data.push({id,name,kelas,item,date,photo,status:'borrowed',created:Date.now()})
        saveLS()
        render()
        // clear form
        nameEl.value='';kelasEl.value='';itemEl.value='';dateEl.value='';photoEl.value=''
        alert('Peminjaman tersimpan')
      }catch(e){alert('Gagal membaca file: '+e)}
    })

    clearAll.addEventListener('click', ()=>{
      if(confirm('Yakin ingin menghapus semua data di browser ini?')){
        data=[];saveLS();render();
      }
    })

    window.startReturn = function(id){
      editingId = id
      modal.classList.add('show')
      modal.setAttribute('aria-hidden','false')
      returnDateEl.value = new Date().toISOString().slice(0,10)
      kondisiEl.value = 'Baik'
      returnPhotoEl.value = ''
    }

    cancelReturn.addEventListener('click', ()=>{
      modal.classList.remove('show')
      modal.setAttribute('aria-hidden','true')
    })

    saveReturn.addEventListener('click', async ()=>{
      if(!editingId) return
      const kondisi = kondisiEl.value
      const rdate = returnDateEl.value || new Date().toISOString().slice(0,10)
      const file = returnPhotoEl.files[0]
      let photo = null
      if(file){
        try{photo = await readFileAsDataURL(file)}catch(e){alert('Gagal membaca foto pengembalian');return}
      }
      const row = data.find(r=>r.id===editingId)
      if(!row) return
      row.status = 'returned'
      row.return = {kondisi,rdate,photo}
      saveLS(); render();
      modal.classList.remove('show');modal.setAttribute('aria-hidden','true')
      editingId = null
      alert('Pengembalian tersimpan')
    })

    exportCSV.addEventListener('click', ()=>{
      if(!data.length){alert('Tidak ada data untuk diexport');return}
      const rows = [['Nama','Kelas','Barang','Tanggal Peminjaman','Status','Tanggal Pengembalian','Kondisi','Foto Peminjaman (dataURL)','Foto Pengembalian (dataURL)']]
      data.forEach(r=>{
        rows.push([
          r.name, r.kelas, r.item, r.date, r.status, r.return? r.return.rdate : '', r.return? r.return.kondisi : '', r.photo || '', r.return? r.return.photo || '' : ''
        ])
      })
      const csv = rows.map(r=>r.map(c=>`"${(''+(c||'')).replace(/"/g,'""')}"`).join(',')).join('\n')
      const blob = new Blob([csv],{type:'text/csv'})
      const url = URL.createObjectURL(blob)
      const a = document.createElement('a')
      a.href = url; a.download = 'peminjaman_tkj.csv'; a.click(); URL.revokeObjectURL(url)
    })

    function escapeHtml(s){return (''+s).replace(/[&<>\"]/g, function(c){return {'&':'&amp;','<':'&lt;','>':'&gt;','\"':'&quot;'}[c]||c})}

    // initial render
    render()
  </script>
</body>
</html>
